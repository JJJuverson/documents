(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{434:function(s,t,a){"use strict";a.r(t);var n=a(3),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"理解scrapy"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#理解scrapy"}},[s._v("#")]),s._v(" 理解Scrapy")]),s._v(" "),a("ul",[a("li",[s._v("Scrapy 是框架")]),s._v(" "),a("li",[s._v("采用异步框架，实现高效的网络采集")]),s._v(" "),a("li",[s._v("最强大的框架")])]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("blockquote",[a("p",[s._v("pip install scrapy")])]),s._v(" "),a("h2",{attrs:{id:"scrapy主要包括以下组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scrapy主要包括以下组件"}},[s._v("#")]),s._v(" scrapy主要包括以下组件")]),s._v(" "),a("ul",[a("li",[s._v("引擎(Scrapy)用来处理整个系统数据流，触发事务(框架核心)")]),s._v(" "),a("li",[s._v("调度器(Scheduler)用来接受引擎发过来的请求，压入队列中，并在引擎再次请求时返回，可以想象成一个URL的优先队列，由它决定下一个要抓取的网址，同时去掉重复网址")]),s._v(" "),a("li",[s._v("下载器(Downloader)用于下载网页内容，并将网页内容返回给Scrapy，下载器是建立在twisted这个高效的异步模型之上")]),s._v(" "),a("li",[s._v("爬虫(Spiders)爬虫主要是干活的，用于从特定的网页中提取自己所需要的信息，即所谓的实体，用户也可以从中提取链接让Scrapy继续抓取下一个链接")]),s._v(" "),a("li",[s._v("项目管道(Pipeline)负责处理爬虫从网页中抓取的实体，主要的功能是持久化实例，验证实例的有效性，清楚不需要的信息。当页面被爬虫解析后，将被发送到项目管道，并经过特定的次序处理数据")]),s._v(" "),a("li",[s._v("下载器中间件(Downloader Middlewares)位于Scrapy引擎和下载器之间的框架，主要处理Scrapy引擎与下载器之间的请求及响应")]),s._v(" "),a("li",[s._v("爬虫中间件(Spider Middlewares)介于Scrapy引擎和爬虫之间的框架，主要工作是处理爬虫的响应输入和请求输出")]),s._v(" "),a("li",[s._v("调度中间件(Scheduler Middlewares)介于Scrapy引擎和调度器之间的中间件，从Scrapy引擎发送到调度的请求和响应")])]),s._v(" "),a("p",[a("img",{attrs:{src:"http://p3.pstatp.com/large/pgc-image/2174422d2fe74ab39160d25bafeb5cfc#pic_center",alt:"Alt"}})]),s._v(" "),a("h2",{attrs:{id:"运行流程如下"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行流程如下"}},[s._v("#")]),s._v(" 运行流程如下")]),s._v(" "),a("ul",[a("li",[s._v("引擎从调度器中提取出一个链接(URL)用于接下来的抓取")]),s._v(" "),a("li",[s._v("引擎把URL封装成一个请求(Request)传给下载器")]),s._v(" "),a("li",[s._v("下载器把资源下载下来，并封装成应答包(Response)")]),s._v(" "),a("li",[s._v("爬虫解析Response")]),s._v(" "),a("li",[s._v("解析出实体，则交给实体管道进行进一步的处理")]),s._v(" "),a("li",[s._v("解析出的是链接(URL),则把URL交给调度器等待抓取")])]),s._v(" "),a("h2",{attrs:{id:"创建项目"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建项目"}},[s._v("#")]),s._v(" 创建项目")]),s._v(" "),a("blockquote",[a("p",[s._v("scrapy startproject demo_name\ncd demo_name")])]),s._v(" "),a("h2",{attrs:{id:"创建爬虫"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建爬虫"}},[s._v("#")]),s._v(" 创建爬虫")]),s._v(" "),a("blockquote",[a("p",[s._v("scrapy genspider 爬虫名字 域名(你要爬的网站 xxx.com)\n注意爬虫名字不能与项目名字一样必须唯一\n网站域名是允许爬虫采集的域名")])]),s._v(" "),a("h1",{attrs:{id:"分析网站"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分析网站"}},[s._v("#")]),s._v(" 分析网站")]),s._v(" "),a("h2",{attrs:{id:"提取数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#提取数据"}},[s._v("#")]),s._v(" 提取数据")]),s._v(" "),a("ul",[a("li",[s._v("正则表达式(基础，必会，难掌握)")]),s._v(" "),a("li",[s._v("XPath --\x3e从HTML中提取数据语法")])]),s._v(" "),a("h2",{attrs:{id:"selectors选择器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#selectors选择器"}},[s._v("#")]),s._v(" Selectors选择器")]),s._v(" "),a("p",[s._v("Scrapy提取数据有自己的套机制。他们被称为选择器(seletors)，因为他们通过特定的XPath或CSS表达式选择HTML文件中的某个部分。本身是基于parsel模块。")]),s._v(" "),a("ul",[a("li",[s._v("我们可以通过使用浏览器的开发者工具来得到我们所需要的节点的XPath表达式，然后通过xpath()方法来得到其内容")]),s._v(" "),a("li",[s._v("response.xpath('xpath表达式').getall()   ----\x3e或者.get()")]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.w3school.com.cn/xpath/xpath_syntax.asp",target:"_blank",rel:"noopener noreferrer"}},[s._v("xpath语法"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"运行爬虫"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行爬虫"}},[s._v("#")]),s._v(" 运行爬虫")]),s._v(" "),a("blockquote",[a("p",[s._v("scrapy crawl 爬虫名")])]),s._v(" "),a("h2",{attrs:{id:"反爬虫"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反爬虫"}},[s._v("#")]),s._v(" 反爬虫")]),s._v(" "),a("ul",[a("li",[s._v("custom_setting")]),s._v(" "),a("li",[s._v("在settings.py中去掉DEFAULT_REQUEST_HEADERS(42)的注释，并且加上一个User-Agent")])]),s._v(" "),a("h2",{attrs:{id:"保存数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#保存数据"}},[s._v("#")]),s._v(" 保存数据")]),s._v(" "),a("blockquote",[a("p",[s._v("scrapy crawl 爬虫名 -o ip.csv(生成文件名及格式)")])]),s._v(" "),a("h2",{attrs:{id:"例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#例子"}},[s._v("#")]),s._v(" 例子")]),s._v(" "),a("div",{staticClass:"language-python line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-python"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -*- coding: utf-8 -*-")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" scrapy\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("XicidailiSpider")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("scrapy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Spider"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xicidaili'")]),s._v("\n    allowed_domains "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'xicidaili.com'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    start_urls "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://xicidaili.com/nn/5'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#解析响应数据，提取数据或者网址，response就是网页源码")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("def")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("parse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  \n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提取数据")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#提取ip port ")]),s._v("\n        selectors "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xpath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'//tr'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#选择所有的tr标签")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 循环遍历tr标签下的td标签")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" selector "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" selectors"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            ip "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" selector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xpath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./td[2]/text()'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("getall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当前节点下继续选择第二个td标签")]),s._v("\n            port "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" selector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xpath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./td[2]/text()'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("getall"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#当前节点下继续选择san个td标签")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#使用一下方法保存数据")]),s._v("\n            items "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'ip'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ip"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n                "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'port'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" port\n\t\t\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),s._v(" items\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 翻页操作")]),s._v("\n        next_page "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("xpath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'//a[@class=\"next_page\"]/@href'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("get"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" next_page"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            next_url "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" response"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("urljoin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("next_page"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#发出请求 yield是生成器 callback是回调函数，将请求得到的响应叫给自己处理，parse是最上面定义的函数")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("yield")]),s._v(" scrapy"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("next_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" callback"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("self"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("parse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);